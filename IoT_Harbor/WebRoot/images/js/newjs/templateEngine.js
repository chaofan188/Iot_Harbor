function Template(tpl) {
	var fn, match;
	var code = [ 'var r=[];\nvar _html = function(str){return str.replace(/&/g, \'&apm;\').replace(/"/g, \'&quot;\').replace(/\'/g, \'&#39;\').replace(/</g, \'&lt;\').replace(/>/g , \'&gt;\');};' ];
	var re = /\{\s*([a-zA-Z\.\_0-9()]+)(\s*\|\s*safe)?\s*\}/m;
	addLine = function(text) {
		code.push('r.push(\''
				+ text.replace(/\'/g, '\\\'').replace(/\n/g, '\\n').replace(
						/\r/g, '\\r') + '\');');
	};
	while (match = re.exec(tpl)) {
		if (match.index > 0) {
			addLine(tpl.slice(0, match.index));
		}

		if (match[2]) {
			code.push('r.push(String(this.' + match[1] + '));');
		} else {
			code.push('r.push(_html(String(this.' + match[1] + ')));');
		}
		tpl = tpl.substring(match.index + match[0].length);
	}
	addLine(tpl);
	code.push('return r.join(\'\');');
	fn = new Function(code.join('\n'));
	this.render = function(model) {
		return fn.apply(model);
	};
}
